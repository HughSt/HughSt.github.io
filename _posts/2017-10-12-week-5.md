---
layout: post
title: Week 5 - Raster analysis
featured-img: LULC
---

Supervised Classification
-------------------------

This tutorial explores supervised classification using R.

Let's first read the Landsat data. To access the Landsat bands, change your working directoty.

Set your directory 

{% highlight r %}
setwd("your working directory")
{% endhighlight %}

Read in and visualize the Landsat files. Get list of all tifs- note the full path, relative to our working directory, is included "/Landsat"" will look at all the files in the folder 'Landsat'.

{% highlight r %}
    all_Landsat <- list.files("path to the Landsat folder on your machine")
{% endhighlight %}

Create a raster stack of the Landsat data. Get a summary of the raster stack. This is like a rasterLayer but instead of having a single raster layer, it is made up of several identical size/resolution rasters.

{% highlight r %}
library(raster)

stacked <- stack(all_Landsat)
plot(stacked)
{% endhighlight %}
![](https://raw.githubusercontent.com/HughSt/HughSt.github.io/master/_posts/week5_files/figure-markdown_github/unnamed-chunk-2-1.png)

Plot True and False Color Composite of the Landsat data.

{% highlight r %}
par(mfrow = c(1,1))
{% endhighlight %}

False Color Composite

{% highlight r %}
plotRGB(stacked, 5,4,3, stretch = 'lin', main = "Landsat False Color Composite")  
{% endhighlight %}

![](https://raw.githubusercontent.com/HughSt/HughSt.github.io/master/_posts/week5_files/figure-markdown_github/unnamed-chunk-4-1.png)

True Color Composite

{% highlight r %}
plotRGB(stacked, 4,3,2, stretch = 'lin', main = "Landsat True Color Composite") 
{% endhighlight %}

![](https://raw.githubusercontent.com/HughSt/HughSt.github.io/master/_posts/week5_files/figure-markdown_github/unnamed-chunk-5-1.png)

Display names of each individual layer.

{% highlight r %}
names(stacked)
{% endhighlight %}

    ## [1] "Landsat_2017_Band1" "Landsat_2017_Band2" "Landsat_2017_Band3"
    ## [4] "Landsat_2017_Band4" "Landsat_2017_Band5" "Landsat_2017_Band6"
    ## [7] "Landsat_2017_Band7"

Rename bands

{% highlight r %}
names(stacked) <- c('band1', 'band2', 'band3', 'band4', 'band5', 'band6', 'band7')
{% endhighlight %}

Train the classifier using training samples. training &lt;- read.csv("LULC\_Training\_Tana.csv", header=T)

Convert training into a SpatialPointsDataFrame.

{% highlight r %}
coordinates(training) <- c("Longitude", "Latitude")
{% endhighlight %}

Train the classifier using training samples. Read in the csv file.
{% highlight r %}
    training <-  read.csv("LULC_Training_Tana.csv", header=T)
{% endhighlight %}

Convert training into a SpatialPointsDataFrame.
{% highlight r %}
coordinates(training) <- c("Longitude", "Latitude")
{% endhighlight %}

Extract values from the image for the point locations.

{% highlight r %}
extract <- as.data.frame(raster::extract(stacked, training))
head(extract) 
{% endhighlight %}

    ##   band1 band2 band3 band4 band5 band6 band7
    ## 1   372   512   823   991  2494  2548  1620
    ## 2   375   483   795  1183  2038  1886  1613
    ## 3   603   780  1378  1111   259   171   141
    ## 4   364   485   806   917  1767  1524   997
    ## 5   355   437   693   765  1972  1990  1427
    ## 6   407   499   759   868  2254  2161  1433
{% endhighlight %}

Now you have extracted the reflectance values at each training data point, you can fit a classification model to predict land use land class given a set of reflectance values.

{% highlight r %}
lulctable <- as.data.frame(training)
ydata <- as.factor(lulctable[,"LULC"])
xdata <- extract
{% endhighlight %}

Fit random forest classification model

{% highlight r %}
library(randomForest)

RF_Model <- randomForest(x=xdata, y=ydata) 
RF_Model

    ## 
    ## Call:
    ##  randomForest(x = xdata, y = ydata) 
    ##                Type of random forest: classification
    ##                      Number of trees: 500
    ## No. of variables tried at each split: 2
    ## 
    ##         OOB estimate of  error rate: 22.5%
    ## Confusion matrix:
    ##    9  10 11  12 13  17 class.error
    ## 9  0   1  2   1  0   0  1.00000000
    ## 10 0 385  6  88  0   2  0.19958420
    ## 11 1  10 12   0  0   4  0.55555556
    ## 12 0 103  1 224  0   0  0.31707317
    ## 13 0   2  0   2  0   0  1.00000000
    ## 17 0   0  2   0  0 154  0.01282051
{% endhighlight %}

Now we have a model of the relationship between land cover and reflectance values, we can predict land cover over our entire region.

{% highlight r %}
outImage <- "Model_2017.tif"
pr2017 <- predict(stacked, RF_Model, filename=outImage, format='GTiff', datatype='INT1U', progress='text', type='response', overwrite=TRUE) 
{% endhighlight %}

    ## 
      |                                                                       
      |                                                                 |   0%
      |                                                                       
      |================                                                 |  25%
      |                                                                       
      |================================                                 |  50%
      |                                                                       
      |=================================================                |  75%
      |                                                                       
      |=================================================================| 100%
    ## 
{% endhighlight %}

Display classification results

{% highlight r %}
par(mfrow = c(1,1))
cols <- c("#e6550d", "#31a354", "#9ecae1", "#addd8e", "#c51b8a", "#2c7fb8")
plot(pr2017, col=cols, legend=FALSE)
legend("bottomleft", legend=c("Savanna", "Grassland", "Wetland", "Cropland", "Urban", "Water"), fill=cols, bg="white")
{% endhighlight %}

![](https://raw.githubusercontent.com/HughSt/HughSt.github.io/master/_posts/week5_files/figure-markdown_github/unnamed-chunk-16-1.png)
